CREATE TABLE "Employee"(
  "EmpDate" Date,
  "Position" Varchar2(30 ) NOT NULL,
  "Education" Varchar2(30 ),
  "PassportInfo" Varchar2(30 ) NOT NULL
);

CREATE INDEX "IX_Relationship5" ON "Employee" ("Position");

ALTER TABLE "Employee" ADD CONSTRAINT "PK_Employee" PRIMARY KEY ("PassportInfo");

CREATE TABLE "Client"(
  "PassportInfo" Varchar2(30 ) NOT NULL
);

ALTER TABLE "Client" ADD CONSTRAINT "PK_Client" PRIMARY KEY ("PassportInfo");

CREATE TABLE "Operation"(
  "Operation_ID" Number NOT NULL,
  "OperationDate" Date,
  "OperationKind" Varchar2(30 ),
  "Sum" Integer NOT NULL,
  "BankAcc_ID" Number NOT NULL,
  "PassportInfo" Varchar2(30 )
);

CREATE INDEX "IX_Relationship3" ON "Operation" ("BankAcc_ID");

CREATE INDEX "IX_Relationship2" ON "Operation" ("PassportInfo");

ALTER TABLE "Operation" ADD CONSTRAINT "PK_Operation" PRIMARY KEY ("Operation_ID");

CREATE TABLE "BankAcc"(
  "BankAcc_ID" Number NOT NULL,
  "DateOpen" Date,
  "DateClose" Date,
  "Sum" Long,
  "Code" Number,
  "PassportInfo" Varchar2(30 )
);

CREATE INDEX "IX_Relationship6" ON "BankAcc" ("Code");

CREATE INDEX "IX_Relationship1" ON "BankAcc" ("PassportInfo");

ALTER TABLE "BankAcc" ADD CONSTRAINT "PK_BankAcc" PRIMARY KEY ("BankAcc_ID");

CREATE TABLE "Job"(
  "Position" Varchar2(30 ) NOT NULL,
  "Seniority" Varchar2(30 )
);

ALTER TABLE "Job" ADD CONSTRAINT "PK_Job" PRIMARY KEY ("Position");

CREATE TABLE "LegalEntity"(
  "Code" Number NOT NULL,
  "Brand" Varchar2(30 ),
  "Type" Varchar2(30 )
);

ALTER TABLE "LegalEntity" ADD CONSTRAINT "PK_LegalEntity" PRIMARY KEY ("Code");

CREATE TABLE "List"(
  "Code" Number NOT NULL,
  "PassportInfo" Varchar2(30 ) NOT NULL
);

ALTER TABLE "List" ADD CONSTRAINT "PK_List" PRIMARY KEY ("PassportInfo","Code");

CREATE TABLE "Person"(
  "PassportInfo" Varchar2(30 ) NOT NULL,
  "Name" Varchar2(30 ),
  "Adress" Varchar2(30 ),
  "BirthDate" Varchar2(30 )
);

ALTER TABLE "Person" ADD CONSTRAINT "PK_Person" PRIMARY KEY ("PassportInfo");

ALTER TABLE "List" ADD CONSTRAINT "Relationship7" FOREIGN KEY ("Code") REFERENCES "LegalEntity" ("Code");

ALTER TABLE "Client" ADD CONSTRAINT "Relationship12" FOREIGN KEY ("PassportInfo") REFERENCES "Person" ("PassportInfo");

ALTER TABLE "Operation" ADD CONSTRAINT "Relationship3" FOREIGN KEY ("BankAcc_ID") REFERENCES "BankAcc" ("BankAcc_ID");

ALTER TABLE "List" ADD CONSTRAINT "Relationship17" FOREIGN KEY ("PassportInfo") REFERENCES "Person" ("PassportInfo");

ALTER TABLE "Employee" ADD CONSTRAINT "Relationship5" FOREIGN KEY ("Position") REFERENCES "Job" ("Position");

ALTER TABLE "BankAcc" ADD CONSTRAINT "Relationship6" FOREIGN KEY ("Code") REFERENCES "LegalEntity" ("Code");

ALTER TABLE "Employee" ADD CONSTRAINT "Relationship13" FOREIGN KEY ("PassportInfo") REFERENCES "Person" ("PassportInfo");

ALTER TABLE "BankAcc" ADD CONSTRAINT "Relationship1" FOREIGN KEY ("PassportInfo") REFERENCES "Client" ("PassportInfo");

ALTER TABLE "Operation" ADD CONSTRAINT "Relationship2" FOREIGN KEY ("PassportInfo") REFERENCES "Employee" ("PassportInfo");

INSERT INTO "Person" VALUES ('SM125476','STARODUBETS','SUMY',TO_DATE('1980-09-15', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('SM329654','BOYKO','ROMNY',TO_DATE('1999-12-12', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('KV057984','SLATVITSKIY','KYIV',TO_DATE('1991-08-17', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('VN329654','IVANOV','VINNYTSYA',TO_DATE('2000-01-01', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('SM321586','GUPAL','SUMY',TO_DATE('1995-06-08', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('SM741985','TOPOROV','SUMY',TO_DATE('2001-07-06', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('SM129873','MARCHENKO','SUMY',TO_DATE('1976-10-13', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('SM465821','PETROV','SUMY',TO_DATE('1984-11-17', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('KV587961','SHKULIPA','KYIV',TO_DATE('2003-01-07', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('SM589462','MISHCHENKO','SUMY',TO_DATE('1988-08-24', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('SM789576','ZAKHAROVA','SUMY',TO_DATE('1990-01-17', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('SM796412','RUBAN','SUMY',TO_DATE('1994-05-11', 'YYYY-MM-DD'));
INSERT INTO "Person" VALUES ('SM398654','KORIKOVA','KONOTOP',TO_DATE('1972-05-31', 'YYYY-MM-DD'));

INSERT INTO "Client" VALUES ('SM125476');
INSERT INTO "Client" VALUES ('SM329654');
INSERT INTO "Client" VALUES ('KV587961');
INSERT INTO "Client" VALUES ('VN329654');
INSERT INTO "Client" VALUES ('SM741985');
INSERT INTO "Client" VALUES ('KV057984');
INSERT INTO "Client" VALUES ('SM398654');
INSERT INTO "Client" VALUES ('SM796412');
INSERT INTO "Client" VALUES ('SM589462');

INSERT INTO "Job" VALUES ('HR','JUNIOR');
INSERT INTO "Job" VALUES ('DEVELOPER',null);
INSERT INTO "Job" VALUES ('MANAGER','SENIOR');
INSERT INTO "Job" VALUES ('TECH_SUPPORT',null);
INSERT INTO "Job" VALUES ('RESEARCHER','MIDDLE');
INSERT INTO "Job" VALUES ('PR','MIDDLE');
INSERT INTO "Job" VALUES ('CASHIER_1',null);
INSERT INTO "Job" VALUES ('CASHIER_2',null);
INSERT INTO "Job" VALUES ('CARETAKER',null);

INSERT INTO "Employee" VALUES (TO_DATE('2021-09-15', 'YYYY-MM-DD'),'HR','HIGH','SM321586');
INSERT INTO "Employee" VALUES (TO_DATE('2022-01-26', 'YYYY-MM-DD'),'DEVELOPER','INCOMP_HIGH','SM741985');
INSERT INTO "Employee" VALUES (TO_DATE('2016-07-01', 'YYYY-MM-DD'),'RESEARCHER','HIGH','SM465821');
INSERT INTO "Employee" VALUES (TO_DATE('2019-06-20', 'YYYY-MM-DD'),'TECH_SUPPORT','HIGH','SM125476');
INSERT INTO "Employee" VALUES (TO_DATE('2005-03-22', 'YYYY-MM-DD'),'MANAGER','HIGH','SM129873');
INSERT INTO "Employee" VALUES (TO_DATE('2011-09-15', 'YYYY-MM-DD'),'PR','HIGH','SM789576');
INSERT INTO "Employee" VALUES (TO_DATE('2014-04-20', 'YYYY-MM-DD'),'CASHIER_1','HIGH','SM589462');
INSERT INTO "Employee" VALUES (TO_DATE('2013-02-17', 'YYYY-MM-DD'),'CASHIER_2','HIGH','SM796412');
INSERT INTO "Employee" VALUES (TO_DATE('2015-04-21', 'YYYY-MM-DD'),'CARETAKER',null,'SM398654');
INSERT INTO "Employee" VALUES (TO_DATE('2014-04-20', 'YYYY-MM-DD'),'CASHIER_1','HIGH','KV587961');

INSERT INTO "LegalEntity" VALUES (108945,'UNIQA',null);
INSERT INTO "LegalEntity" VALUES (202437,'CORONA','CORPORATION');
INSERT INTO "LegalEntity" VALUES (317894,'JOMA',null);
INSERT INTO "LegalEntity" VALUES (025789,'NETCRACKER','COMPANY');
INSERT INTO "LegalEntity" VALUES (505689,'AMC','COMPANY');

INSERT INTO "BankAcc" VALUES (100,TO_DATE('2019-11-18', 'YYYY-MM-DD'),TO_DATE('2022-11-18', 'YYYY-MM-DD'),500000,025789,null);
INSERT INTO "BankAcc" VALUES (101,TO_DATE('2019-12-06', 'YYYY-MM-DD'),TO_DATE('2022-12-06', 'YYYY-MM-DD'),500000,null,'KV587961');
INSERT INTO "BankAcc" VALUES (102,TO_DATE('2020-06-22', 'YYYY-MM-DD'),TO_DATE('2023-06-22', 'YYYY-MM-DD'),6580,null,'SM329654');
INSERT INTO "BankAcc" VALUES (103,TO_DATE('2020-09-15', 'YYYY-MM-DD'),TO_DATE('2023-09-15', 'YYYY-MM-DD'),50000,202437,null);
INSERT INTO "BankAcc" VALUES (104,TO_DATE('2020-10-01', 'YYYY-MM-DD'),TO_DATE('2023-10-01', 'YYYY-MM-DD'),50000,null,'VN329654');
INSERT INTO "BankAcc" VALUES (105,TO_DATE('2021-04-01', 'YYYY-MM-DD'),TO_DATE('2024-04-01', 'YYYY-MM-DD'),7468,null,'SM741985');
INSERT INTO "BankAcc" VALUES (106,TO_DATE('2021-07-06', 'YYYY-MM-DD'),TO_DATE('2024-07-06', 'YYYY-MM-DD'),7000,null,'SM329654');
INSERT INTO "BankAcc" VALUES (107,TO_DATE('2022-08-18', 'YYYY-MM-DD'),TO_DATE('2025-08-18', 'YYYY-MM-DD'),100000,108945,null);
INSERT INTO "BankAcc" VALUES (108,TO_DATE('2022-11-30', 'YYYY-MM-DD'),TO_DATE('2025-11-30', 'YYYY-MM-DD'),300,null,'SM398654');
INSERT INTO "BankAcc" VALUES (109,TO_DATE('2022-12-19', 'YYYY-MM-DD'),TO_DATE('2025-12-19', 'YYYY-MM-DD'),25000,null,'SM796412');
INSERT INTO "BankAcc" VALUES (110,TO_DATE('2022-12-19', 'YYYY-MM-DD'),TO_DATE('2025-12-19', 'YYYY-MM-DD'),250000,null,'SM589462');

INSERT INTO "Operation" VALUES (2000,TO_DATE('2022-01-05 00:40:59', 'YYYY-MM-DD HH24:MI:SS'),'INCOME', 15862, 101,'SM796412');
INSERT INTO "Operation" VALUES (2001,TO_DATE('2022-04-21 03:17:40', 'YYYY-MM-DD HH24:MI:SS'),'OUTCOME', -79628, 105,'SM741985');
INSERT INTO "Operation" VALUES (2002,TO_DATE('2022-05-07 11:03:45', 'YYYY-MM-DD HH24:MI:SS'),'OUTCOME', -44365, 102,'SM589462');
INSERT INTO "Operation" VALUES (2003,TO_DATE('2022-08-22 04:54:30', 'YYYY-MM-DD HH24:MI:SS'),'OUTCOME', -58766, 104,'SM796412');
INSERT INTO "Operation" VALUES (2004,TO_DATE('2022-09-01 13:00:15', 'YYYY-MM-DD HH24:MI:SS'),'INCOME', 50000, 105,'SM741985');
INSERT INTO "Operation" VALUES (2005,TO_DATE('2022-10-14 07:41:13', 'YYYY-MM-DD HH24:MI:SS'),'INCOME', 11287, 100,'SM589462');
INSERT INTO "Operation" VALUES (2006,TO_DATE('2022-11-30 07:41:13', 'YYYY-MM-DD HH24:MI:SS'),'INCOME', 10000, 101,'SM796412');
INSERT INTO "Operation" VALUES (2007,TO_DATE('2022-11-30 13:00:15', 'YYYY-MM-DD HH24:MI:SS'),'OUTCOME', -9814, 102,'SM796412');

INSERT INTO "List" VALUES (108945,'KV057984');
INSERT INTO "List" VALUES (202437,'SM465821');
INSERT INTO "List" VALUES (317894,'SM129873');
INSERT INTO "List" VALUES (025789,'SM741985');
INSERT INTO "List" VALUES (505689,'SM329654');
INSERT INTO "List" VALUES (317894,'SM741985');
INSERT INTO "List" VALUES (108945,'KV587961');
INSERT INTO "List" VALUES (505689,'VN329654');

ALTER TABLE "Client" ADD "Sanc" Char(3) DEFAULT 'No' NOT NULL;

UPDATE "Client"
SET "Sanc" = 'Yes'
WHERE "PassportInfo" IN ('SM329654','KV587961');

ALTER TABLE "BankAcc" ADD "Sanc" Char(3) DEFAULT 'No' NOT NULL;

UPDATE "BankAcc"
SET "Sanc" = 'Yes'
WHERE "PassportInfo" IN (SELECT "PassportInfo" FROM "Client" WHERE "Sanc" = 'Yes');

ALTER TABLE "LegalEntity" ADD "Sanc" Char(3) DEFAULT 'No' NOT NULL;

UPDATE "LegalEntity"
SET "Sanc" = 'Yes'
WHERE "Code" IN (108945);

UPDATE "Client"
SET "Sanc" = 'Yes'
WHERE "PassportInfo" IN (SELECT "PassportInfo" From "Person"
WHERE "PassportInfo" IN (SELECT "PassportInfo" FROM "List"
WHERE "Code" IN (SELECT "Code" FROM "LegalEntity" WHERE "Sanc" = 'Yes')));

UPDATE "BankAcc" SET "Sanc" = 'Yes'
WHERE "Code" IN (SELECT "Code" FROM "LegalEntity" WHERE "Sanc" = 'Yes')
OR "PassportInfo" IN (SELECT "PassportInfo" FROM "Client" WHERE "Sanc" = 'Yes');

ALTER TABLE "Operation" ADD CHECK ("OperationKind" IN ('INCOME','OUTCOME','BONUS'));

ALTER TABLE "Operation" ADD CHECK ("OperationKind" = 'INCOME' AND "Sum" > 0
OR "OperationKind" = 'OUTCOME' AND "Sum" < 0
OR "OperationKind" = 'BONUS' AND "Sum" <> 0);

ALTER TABLE "BankAcc" ADD "Cur" CHAR(3) DEFAULT 'UAH' NOT NULL;

UPDATE "BankAcc"
SET "Cur" = 'CHF' WHERE "PassportInfo" = 'SM398654';

UPDATE "BankAcc"
SET "Cur" = 'CHF' WHERE "PassportInfo" = 'VN329654' OR "Code" = 202437;

ALTER TABLE "Employee" ADD "Manager" VARCHAR2(30);

UPDATE "Employee" SET "Manager" = 'SM129873' WHERE "PassportInfo" = 'SM398654';
UPDATE "Employee" SET "Manager" = 'SM129873' WHERE "PassportInfo" = 'SM321586';
UPDATE "Employee" SET "Manager" = 'SM465821' WHERE "PassportInfo" = 'SM741985';
UPDATE "Employee" SET "Manager" = 'SM129873' WHERE "PassportInfo" = 'SM465821';
UPDATE "Employee" SET "Manager" = 'SM741985' WHERE "PassportInfo" = 'SM125476';
UPDATE "Employee" SET "Manager" = 'SM129873' WHERE "PassportInfo" = 'SM789576';
UPDATE "Employee" SET "Manager" = 'SM125476' WHERE "PassportInfo" = 'SM589462';
UPDATE "Employee" SET "Manager" = 'SM589462' WHERE "PassportInfo" = 'SM796412';
UPDATE "Employee" SET "Manager" = 'SM125476' WHERE "PassportInfo" = 'KV587961';